# InMemoryServerClient - Copilotインストラクション

## 重要: 対話言語について
AIとのすべてのやり取りは日本語で行います。説明、コメント、ドキュメンテーションは日本語で記述してください。コードは英語（C#）で記述してください。コード中のコメントも英語で記述します。

## プロジェクト概要
このプロジェクトは、C#でインメモリステートフルサーバーとCLIクライアントを実装します。サーバーはメモリ内に状態を保持し、クライアントがこの状態と対話するためのインターフェースを提供します。クライアントはコマンドラインインターフェースで、サーバーに接続してユーザーがサーバーの状態を操作できるようにします。

## アーキテクチャ

### サーバー
- メモリ内にデータを保持するステートフルサーバーを実装
- 通信には.NETのTCP/IP機能またはSignalRを使用
- 複数の同時クライアント接続をサポート
- 必要に応じて状態を保存するクリーンなシャットダウンプロセスを含める
- クライアントリクエスト処理にコマンドパターンを実装
- 適切なエラー処理とロギングを含める

### クライアント
- コマンドラインインターフェース（CLI）クライアントの実装
- サーバーへの接続管理をサポート
- サーバー状態を操作するための直感的なコマンドを提供
- ヘルプコマンドとドキュメントを含める
- ネットワーク問題に対する適切なエラー処理を実装

## コードスタイルと実践

- C#のコーディング規約とベストプラクティスに従う
- すべてのI/O操作にasync/awaitを使用
- 適切な例外処理を実装
- 公開APIにはXMLドキュメントコメントを含める
- 変更後にビルドを実行して、コード品質を確保する。`dotnet build`を使用してソリューションをコンパイルする
- サーバーとクライアントの両方のコンポーネントに対するユニットテストを作成する。`dotnet test`を使用してテストを実行する
- 適切な場所で依存性注入を使用
- SOLIDの原則に従う

## プロジェクト構造

- ソリューションを明確なプロジェクトに分ける：
  - `InMemoryServer` - サーバー実装
  - `CliClient` - コマンドラインクライアント
  - `Shared` - 共有コード、モデル、インターフェース
  - `Tests` - ユニットテストと統合テスト

## 実装する機能

1. サーバー：
   - CRUD操作を備えたインメモリデータストレージ
   - 認証メカニズム（オプション）
   - コマンド処理パイプライン
   - 状態の永続化（オプション）
   - ヘルスチェックエンドポイント

2. クライアント：
   - インタラクティブコマンドモード
   - バッチコマンドモード
   - 接続管理
   - 結果の美しい表示
   - コマンド履歴

## 技術スタック
- .NET 9以上
- C# 13以上
- CLIパーシング用のConsoleAppFramework
- サーバーにはMicrosoft.Extensions.Hostingの使用を検討

## 開発ガイドライン
- クリーンで読みやすく保守しやすいコードを書く
- 適切なコメントを含める
- インメモリ状態のパフォーマンスへの影響を考慮する
- 拡張性を考慮した設計
- 適切なロギングを実装する
- サーバーのスレッドセーフティを考慮する

## テスト
- サーバーコマンドハンドラーのユニットテスト
- クライアントコマンドパーシングのユニットテスト
- サーバー-クライアント通信の統合テスト
- 同時接続のロードテスト（オプション）

コードを生成する際は、サーバーとクライアントの両方のコンポーネントが構造化され、最新のC#プラクティスに従い、適切なエラー処理とドキュメントを含むようにしてください。
